# ble_advertisements
-------------------------------------------------------------------------------

## 说明

该实例程序展示了如何使用 bt_smartbridge 框架操作蓝牙设备作为从设备时进行不同模式的广播以及在如何使用蓝牙控制器的白名单功能过滤主设备的 SCAN_REQ 以及 CONNECT_REQ 请求。

### 蓝牙设备的广播模式：

* 通用广播：进行通用广播的设备能够被扫描到，或者在接收到连接请求时作为从设备建立一个连接。
* 定向广播：定向广播是一种为了尽可能快的建立连接而向指定设备广播自己的一种广播方式。定向广播必须指定目标设备的地址。
* 不可连接广播：不想被连接的设备使用不可连接类型广播。这种广播的典型应用包括设备执行广播数据，而不想被连接或者主动扫描。
* 可发现广播：这种设备不能用于发起连接，但是允许其他设备扫描该设备。

### 蓝牙设备的广播策略

蓝牙广播时也可以设置过滤策略以便使用白名单功能过滤主设备的SCAN_REQ以及CONNECT_REQ请求。当控制器的白名单中包括该设备，那么此设备的SCAN_REQ或者CONNECT_REQ才会被处理，否则忽略。过滤策略可以是以下中的一个：

* 不使用白名单
* 将白名单仅应用于过滤SCAN_REQ请求
* 将白名单仅应用于CONNECT_REQ请求
* 将白名单既用于过滤SCAN_REQ也用于过滤CONNECT_REQ请求

## 使用方法

本示例程序要求用户输入相应的指令触发相应的广播模式，为了简化程序，具体的广播数据不能通过指令配置，这里只是作为一种使用方式展示出来。在实际的开发中，具体的广播数据还是要根据需要填充的。本示例的广播数据一律使用默认设置，用户可以在程序代码中自行修改。

示例程序启动之后，默认进入通用广播模式。用户可以使用指定的指令设置不同的广播模式。

* `advert start <mode> [duty]`：其中mode必填，duty可选。mode就是广播的模式：0 - 通用广播模式；1 - 可发现广播；2 - 定向广播；3 - 不可连接广播。duty是指定广播包频率大小的：0 - 长间隔高负载；1 - 短间隔低负载。当模式为2时，不必指定duty值，内部默认使用high duty方式。用户可以在代码中更改duty的间隔值，但是必须符合蓝牙协议规范的取值范围。

* `advert stop`：停止当前广播

* `policy [value]`：设置过滤策略，其中value为必填。0 - 不使用白名单；1 - 仅用于SCAN_REQ；2 - 仅用于CONNECT_REQ；3 - 同时用于二者。

* `wlsize [value]`：获取当前蓝牙控制器中白名单的有效设备数量或者是白名单的容量，具体根据参数决定。1 - 获取白名单中有效设备数，2 - 获取当前白名单的容量。

